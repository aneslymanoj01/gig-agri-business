<div class="change-password-container">
  <div class="change-password-card">
    <div class="header">
      <mat-icon class="header-icon">lock_reset</mat-icon>
      <h1 class="title">Change Password</h1>
      <p class="subtitle">Please update your password to continue</p>
    </div>

    <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" class="change-password-form">
      
      <!-- Old Password -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Current Password</mat-label>
        <input matInput 
               [type]="hideOldPassword ? 'password' : 'text'"
               formControlName="oldPassword" 
               placeholder="Enter current password">
        <button mat-icon-button matSuffix (click)="hideOldPassword = !hideOldPassword" type="button">
          <mat-icon>{{ hideOldPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="changePasswordForm.get('oldPassword')?.invalid && changePasswordForm.get('oldPassword')?.touched">
          {{ getErrorMessage('oldPassword') }}
        </mat-error>
      </mat-form-field>

      <!-- New Password -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>New Password</mat-label>
        <input matInput 
               [type]="hideNewPassword ? 'password' : 'text'"
               formControlName="newPassword" 
               placeholder="Enter new password">
        <button mat-icon-button matSuffix (click)="hideNewPassword = !hideNewPassword" type="button">
          <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="changePasswordForm.get('newPassword')?.invalid && changePasswordForm.get('newPassword')?.touched">
          {{ getErrorMessage('newPassword') }}
        </mat-error>
      </mat-form-field>

      <!-- Password Strength Indicator -->
      <div class="password-strength" *ngIf="changePasswordForm.get('newPassword')?.value">
        <div class="strength-label">Password Strength: 
          <span [style.color]="getPasswordStrength().color">{{ getPasswordStrength().strength }}</span>
        </div>
        <div class="strength-bar">
          <div class="strength-fill" 
               [style.width]="getPasswordStrength().width"
               [style.background-color]="getPasswordStrength().color">
          </div>
        </div>
      </div>

      <!-- Confirm Password -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirm New Password</mat-label>
        <input matInput 
               [type]="hideConfirmPassword ? 'password' : 'text'"
               formControlName="confirmPassword" 
               placeholder="Confirm new password">
        <button mat-icon-button matSuffix (click)="hideConfirmPassword = !hideConfirmPassword" type="button">
          <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="(changePasswordForm.get('confirmPassword')?.invalid && changePasswordForm.get('confirmPassword')?.touched) || changePasswordForm.hasError('passwordMismatch')">
          {{ getErrorMessage('confirmPassword') }}
        </mat-error>
      </mat-form-field>

      <!-- Password Requirements -->
      <div class="password-requirements">
        <h4>Password Requirements:</h4>
        <ul>
          <li>At least 8 characters long</li>
          <li>Contains uppercase letter (A-Z)</li>
          <li>Contains lowercase letter (a-z)</li>
          <li>Contains number (0-9)</li>
          <li>Contains special character (&#35;?!&#64;$%^&amp;*-)</li>
        </ul>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button mat-stroked-button 
                type="button" 
                (click)="onCancel()"
                [disabled]="isLoading"
                class="cancel-button">
          Cancel
        </button>
        
        <button mat-raised-button 
                color="primary" 
                type="submit" 
                [disabled]="isLoading || changePasswordForm.invalid"
                class="submit-button">
          <mat-spinner *ngIf="isLoading" diameter="20" class="button-spinner"></mat-spinner>
          <span *ngIf="!isLoading">Update Password</span>
          <span *ngIf="isLoading">Updating...</span>
        </button>
      </div>
    </form>
  </div>

  <div class="background-pattern"></div>
</div>
