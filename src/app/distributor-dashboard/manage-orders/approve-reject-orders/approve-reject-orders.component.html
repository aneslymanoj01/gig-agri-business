<div class="approve-reject-orders-page">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="breadcrumb">
        <span class="breadcrumb-item">Dashboard</span>
        <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
        <span class="breadcrumb-item" (click)="goBack()">Manage Orders</span>
        <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
        <span class="breadcrumb-item active">Approve/Reject Orders</span>
      </div>
      <h1 class="page-title">
        <mat-icon class="title-icon">check_circle</mat-icon>
        Approve/Reject Orders
      </h1>
      <p class="page-subtitle">Review and approve or reject dealer orders</p>
    </div>
  </div>

  <!-- Content Section -->
  <div class="content-container">
    
    <!-- Search Section -->
    <div class="search-section">
      <div class="search-container">
        <div class="search-card">
          <div class="card-header">
            <mat-icon class="card-icon">search</mat-icon>
            <div class="card-title">
              <h3>Search Order</h3>
              <p>Enter order ID to review and approve/reject</p>
            </div>
          </div>
          
          <div class="search-form">
            <div class="form-grid">
              <mat-form-field appearance="outline">
                <mat-label>Order ID</mat-label>
                <input matInput type="number" [(ngModel)]="searchOrderId" placeholder="Enter order ID">
                <mat-icon matSuffix>receipt</mat-icon>
              </mat-form-field>
            </div>
            
            <div class="form-actions">
              <button mat-raised-button color="primary" (click)="searchOrder()" [disabled]="isLoading">
                <mat-icon *ngIf="isLoading">hourglass_empty</mat-icon>
                <mat-icon *ngIf="!isLoading">search</mat-icon>
                {{isLoading ? 'Searching...' : 'Search Order'}}
              </button>
              <button mat-stroked-button (click)="clearSearch()">
                <mat-icon>clear</mat-icon> Clear Search
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Details Section -->
    <div *ngIf="order" class="order-details-section">
      <mat-card class="order-card">
        
        <!-- Order Header -->
        <mat-card-header>
          <div class="order-header">
            <div class="order-info">
              <h3 class="order-id">Order #{{order.orderId}}</h3>
              <div class="order-meta">
                <span class="created-date">
                  <mat-icon>schedule</mat-icon>
                  Created: {{order.createdAt | date:'MMM dd, yyyy HH:mm'}}
                </span>
                <span class="item-count">
                  <mat-icon>inventory</mat-icon>
                  {{order.itemCount}} item(s)
                </span>
              </div>
            </div>
            <div class="status-badge" [style.background-color]="getStatusColor(order.status)">
              <mat-icon>{{getStatusIcon(order.status)}}</mat-icon>
              <span>{{order.status}}</span>
            </div>
          </div>
        </mat-card-header>

        <!-- Order Content -->
        <mat-card-content>
          
          <!-- Order Summary -->
          <div class="order-summary">
            <div class="summary-row">
              <span class="label">Total Amount:</span>
              <span class="value total-amount">LKR {{ order.totalAmount }}</span>
            </div>
          </div>

          <!-- Items List -->
          <div class="items-section">
            <h4>Order Items</h4>
            <div class="items-list">
              <div *ngFor="let item of order.items" class="item-row">
                <div class="item-info">
                  <span class="item-name">{{item.productName}}</span>
                  <span class="item-details">
                    Qty: {{item.quantity}} Ã— LKR {{item.unitPrice}} = LKR {{item.quantity * item.unitPrice}}
                  </span>
                </div>
              </div>
            </div>
          </div>

        </mat-card-content>

        <!-- Action Buttons -->
        <mat-card-actions *ngIf="order.status === 'PENDING'" class="action-buttons">
          <div class="button-container">
            <button mat-raised-button class="approve-btn" (click)="approveOrder()" [disabled]="isProcessing">
              <mat-icon *ngIf="isProcessing">hourglass_empty</mat-icon>
              <mat-icon *ngIf="!isProcessing">check_circle</mat-icon>
              {{isProcessing ? 'Approving...' : 'Approve Order'}}
            </button>
            <button mat-raised-button class="reject-btn" (click)="openRejectDialog()" [disabled]="isProcessing">
              <mat-icon>cancel</mat-icon> Reject Order
            </button>
          </div>
        </mat-card-actions>

        <mat-card-actions *ngIf="order.status !== 'PENDING'">
          <div class="status-message">
            <mat-icon>info</mat-icon>
            <span *ngIf="order.status === 'APPROVED'">This order has already been approved.</span>
            <span *ngIf="order.status === 'REJECTED'">This order has been rejected.</span>
            <span *ngIf="order.status !== 'APPROVED' && order.status !== 'REJECTED'">
              This order cannot be approved or rejected in its current status.
            </span>
          </div>
        </mat-card-actions>

      </mat-card>
    </div>

  </div>

</div>

<!-- Reject Dialog -->
<div *ngIf="showRejectDialog" class="dialog-overlay" (click)="closeRejectDialog()">
  <div class="dialog-content" (click)="$event.stopPropagation()">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Reject Order</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>Please provide a reason for rejecting this order:</p>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Rejection Reason</mat-label>
          <textarea matInput [(ngModel)]="rejectReason" rows="3" 
                    placeholder="Enter rejection reason"></textarea>
        </mat-form-field>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button (click)="closeRejectDialog()">Cancel</button>
        <button mat-raised-button color="warn" (click)="rejectOrder()" 
                [disabled]="!rejectReason.trim() || isProcessing">
          <mat-icon *ngIf="isProcessing">hourglass_empty</mat-icon>
          <mat-icon *ngIf="!isProcessing">cancel</mat-icon>
          {{isProcessing ? 'Rejecting...' : 'Reject Order'}}
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
